<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demande de matériel</title>

  <!-- Google Fonts et Font Awesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Favicon et icônes pour mobile -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#fab40a">

  <!-- Ton CSS existant -->
  <link rel="stylesheet" href="style.css">
</head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demande de matériel</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Roboto', sans-serif;
  background-color: #696767;
  color: white;
}

header { display: flex; justify-content: center; margin-top: 25px; }

.header-container {
  background: linear-gradient(135deg, #fab40a, #e69500);
  padding: 30px 55px;
  border-radius: 30px;
  display: flex;
  align-items: center;
  gap: 30px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.45);
}

.header-container img { height: 100px; }

.header-text h1 {
  font-family: 'Montserrat', sans-serif;
  font-size: 2.4rem;
  letter-spacing: 3px;
  margin: 0;
  color: black;
  text-transform: uppercase;
}

.header-text p { margin-top: 5px; color: #333; }

main { max-width: 800px; margin: 35px auto; padding: 30px; }

.section {
  background-color: #808080;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.4);
  margin-bottom: 25px;
}

.section h3 { margin-top: 0; color: #fab40a; display: flex; align-items: center; gap: 10px; }

label { display: block; margin-top: 15px; }

.input-wrapper { position: relative; }

.field-icon { position: absolute; top: 38px; left: 12px; color: #fab40a; }

input, select {
  width: 100%;
  padding: 12px 12px 12px 38px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background-color: #e0e0e0;
  color: black;
  font-size: 16px;
}

input[readonly] { background-color: #d0d0d0; }

.radio-wrapper {
  margin-top: 12px;
  display: flex;
  justify-content: center;
  gap: 30px;
  font-weight: 500;
  color: white;
}

.radio-wrapper.hidden { display: none; }

.radio-wrapper input[type="radio"] {
  margin-right: 6px;
  width: 18px;
  height: 18px;
  cursor: pointer;
}

button {
  width: 100%;
  padding: 16px;
  margin-top: 25px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 16px;
  background: linear-gradient(135deg, #fab40a, #e69500);
  cursor: pointer;
}

.footer-logo { text-align: center; margin-top: 40px; }

.footer-logo img { height: 70px; }

/* Pour les petits écrans */
@media (max-width: 480px) {
  main {
    margin: 20px 10px; /* moins de marge */
    padding: 15px;     /* moins de padding */
  }

  .header-container {
    flex-direction: column; /* empile logo et texte */
    padding: 15px;
    gap: 15px;
  }

  input, select, button {
    font-size: 14px;  /* texte plus petit */
    padding: 10px 10px 10px 35px; /* padding réduit */
  }

  .field-icon {
    top: 30px; /* ajuster la position de l'icône dans les champs */
    left: 10px;
  }

  .radio-wrapper {
    flex-direction: column; /* empile les radios au lieu d'être sur une ligne */
    gap: 10px;
    align-items: flex-start;
  }

  .section {
    padding: 15px;
  }
}
/* ======= CSS responsive pour téléphones ======= */
@media (max-width: 480px) {
  main {
    margin: 15px 10px;
    padding: 10px;
  }

  .header-container {
    flex-direction: column;
    padding: 15px;
    gap: 10px;
  }

  .header-text h1 {
    font-size: 1.6rem; /* réduit le titre sur mobile */
    letter-spacing: 1.5px;
    text-align: center;
  }

  .header-text p {
    font-size: 0.9rem;
    text-align: center;
  }

  input, select, button {
    font-size: 14px;
    padding: 8px 10px 8px 35px; /* réduit la taille des champs */
  }

  .field-icon {
    top: 28px;
    left: 10px; /* ajustement pour rester bien aligné */
  }

  .radio-wrapper {
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
  }

  .section {
    padding: 15px;
  }
}


</style>
</head>

<body>

<header>
  <div class="header-container">
    <img src="logo.png" alt="Logo entreprise">
    <div class="header-text">
      <h1>Boussiquet Locations</h1>
      <p>Demande interne de matériel</p>
    </div>
  </div>
</header>

<main>

<form id="demandeForm">

<!-- MATÉRIEL -->
<div class="section">
  <h3><i class="fas fa-tools"></i> Matériel</h3>

  <div class="input-wrapper">
    <i class="fas fa-layer-group field-icon"></i>
    <label>Catégorie</label>
    <select id="categorie"></select>
  </div>

  <div class="input-wrapper" id="sousTypeSelectWrapper">
    <i class="fas fa-cubes field-icon"></i>
    <label>Sous-type</label>
    <select id="sousType"></select>
  </div>

  <div class="input-wrapper" id="sousTypeLibreWrapper" style="display:none;">
    <i class="fas fa-pen field-icon"></i>
    <label>Précisez le matériel</label>
    <input type="text" id="sousTypeLibre">
  </div>

  <!-- CARBURANT -->
  <div class="radio-wrapper hidden" id="carburantWrapper">
    <label><input type="radio" name="carburant" value="Electrique"> Électrique</label>
    <label><input type="radio" name="carburant" value="Diesel"> Diesel</label>
  </div>

  <!-- ROUES -->
  <div class="radio-wrapper hidden" id="rouesWrapper">
    <label><input type="radio" name="roues" value="Petites roues"> Petites roues</label>
    <label><input type="radio" name="roues" value="4x4"> 4x4</label>
  </div>

</div>

<!-- CHANTIER -->
<div class="section">
  <h3><i class="fas fa-map-marker-alt"></i> Chantier</h3>

  <div class="input-wrapper">
    <i class="fas fa-building field-icon"></i>
    <label>Nom du chantier</label>
    <input type="text" id="chantierNom">
  </div>

  <div class="input-wrapper">
    <i class="fas fa-location-dot field-icon"></i>
    <label>Adresse du chantier</label>
    <input type="text" id="chantierAdresse">
  </div>
</div>

<!-- LOCATION -->
<div class="section">
  <h3><i class="fas fa-calendar-alt"></i> Location</h3>

  <div class="input-wrapper">
    <i class="fas fa-play field-icon"></i>
    <label>Date de début</label>
    <input type="date" id="dateDebut">
  </div>

  <div class="input-wrapper">
    <i class="fas fa-hourglass-half field-icon"></i>
    <label>Durée (jours)</label>
    <input type="number" id="duree">
  </div>
</div>

<!-- CHEF D'ÉQUIPE -->
<div class="section">
  <h3><i class="fas fa-user-hard-hat"></i> Chef d’équipe</h3>

  <div class="input-wrapper">
    <i class="fas fa-user field-icon"></i>
    <label>Responsable sur place</label>
    <select id="chefEquipe"></select>
  </div>

  <div class="input-wrapper">
    <i class="fas fa-phone field-icon"></i>
    <label>Téléphone</label>
    <input type="text" id="telephoneChef" readonly>
  </div>
</div>

<button type="submit">Envoyer la demande</button>

</form>

<div class="footer-logo">
  <img src="logo2.png" alt="Logo bas">
</div>

</main>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let materielData = {};
let personnelData = [];

// ======== RÈGLES MATÉRIEL ========
const reglesMateriel = {
  "Nacelle articulée": { 
    "12m": { carburant: ["Electrique","Diesel"], roues: ["Petites roues","4x4"] },
    "16m": { carburant: ["Electrique","Diesel"], roues: ["Petites roues","4x4"] },
    "18m": { carburant: ["Electrique","Diesel"], roues: ["4x4"] },
    "20m": { carburant: ["Diesel"], roues: ["4x4"] },
    "22m": { carburant: ["Diesel"], roues: ["4x4"] },
    "26m": { carburant: ["Diesel"], roues: ["4x4"] },
    "28m": { carburant: ["Diesel"], roues: ["4x4"] },
    "32m": { carburant: ["Diesel"], roues: ["4x4"] },
    "40m": { carburant: ["Diesel"], roues: ["4x4"] }
  },
  "Nacelle mât vertical": {
    "6m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "8m": { carburant: ["Electrique"], roues: ["Petites roues"] }
  },
  "Nacelle ciseau": {
    "6m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "8m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "10m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "12m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "14m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "16m": { carburant: ["Electrique","Diesel"], roues: ["Petites roues","4x4"] },
    "18m": { carburant: ["Electrique","Diesel"], roues: ["Petites roues","4x4"] }
  },
  "Nacelle Toucan": {
    "6m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "8m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "10m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "12m": { carburant: ["Electrique"], roues: ["Petites roues"] },
    "15m": { carburant: ["Electrique"], roues: ["Petites roues"] }
  },
  "MRT": {
    "16m": { carburant: ["Diesel"], roues: ["4x4"] },
    "21m": { carburant: ["Diesel"], roues: ["4x4"] },
    "25m": { carburant: ["Diesel"], roues: ["4x4"] }
  },
  "Chariot télescopique": {
    "6/7m": { carburant: ["Electrique","Diesel"], roues: ["4x4"] },
    "9m": { carburant: ["Electrique","Diesel"], roues: ["4x4"] },
    "13/14m": { carburant: ["Electrique","Diesel"], roues: ["4x4"] },
    "16/17m": { carburant: ["Diesel"], roues: ["4x4"] },
    "18m": { carburant: ["Diesel"], roues: ["4x4"] },
    "20m": { carburant: ["Diesel"], roues: ["4x4"] }
  },
  "Camion Nacelle": {
    "16/17m": { carburant: ["Diesel"], roues: ["4x4"] },
    "21m": { carburant: ["Diesel"], roues: ["4x4"] }
  }
  // Ajouter les autres types si nécessaire
};

// ======== CHARGEMENT JSON ========
async function chargerMateriel() {
  const res = await fetch('materiel.json');
  materielData = await res.json();

  const catSelect = document.getElementById('categorie');
  catSelect.innerHTML = Object.keys(materielData)
    .map(c => `<option value="${c}">${c}</option>`).join('');

  catSelect.addEventListener('change', majSousTypes);
  majSousTypes();
}

function majSousTypes() {
  const cat = document.getElementById('categorie').value;
  const selectW = document.getElementById('sousTypeSelectWrapper');
  const libreW = document.getElementById('sousTypeLibreWrapper');
  const sousTypeSelect = document.getElementById('sousType');

  if(cat === "Divers") {
    selectW.style.display = "none";
    libreW.style.display = "block";
    sousTypeSelect.innerHTML = "";
    appliquerReglesMateriel(null);
  } else {
    selectW.style.display = "block";
    libreW.style.display = "none";
    sousTypeSelect.innerHTML = materielData[cat].map(s => `<option>${s}</option>`).join('');
    appliquerReglesMateriel(sousTypeSelect.value);
    sousTypeSelect.onchange = () => appliquerReglesMateriel(sousTypeSelect.value);
  }
}

// ======== FONCTION RADIOS ========
function appliquerReglesMateriel(sousType) {
  const cat = document.getElementById('categorie').value;
  const carburantWrapper = document.getElementById('carburantWrapper');
  const rouesWrapper = document.getElementById('rouesWrapper');

  const carburants = document.querySelectorAll("input[name='carburant']");
  const roues = document.querySelectorAll("input[name='roues']");

  carburantWrapper.classList.add("hidden");
  rouesWrapper.classList.add("hidden");

  carburants.forEach(r => { r.checked = false; r.disabled = false; });
  roues.forEach(r => { r.checked = false; r.disabled = false; });

  if(!reglesMateriel[cat] || !reglesMateriel[cat][sousType]) return;

  const regle = reglesMateriel[cat][sousType];

  carburantWrapper.classList.remove("hidden");
  rouesWrapper.classList.remove("hidden");

  carburants.forEach(r => { if(!regle.carburant.includes(r.value)) r.disabled = true; });
  roues.forEach(r => { if(!regle.roues.includes(r.value)) r.disabled = true; });

  if(regle.carburant.length === 1) carburants.forEach(r => { if(!r.disabled) r.checked = true; });
  if(regle.roues.length === 1) roues.forEach(r => { if(!r.disabled) r.checked = true; });
}

// ======== PERSONNEL ========
async function chargerPersonnel() {
  const res = await fetch('personnel.json');
  personnelData = await res.json();

  const select = document.getElementById('chefEquipe');
  select.innerHTML = personnelData.map((p,i) => `<option value="${i}">${p.nom}</option>`).join('');
  select.addEventListener('change', majTelephone);
  majTelephone();
}

function majTelephone() {
  const index = document.getElementById('chefEquipe').value;
  document.getElementById('telephoneChef').value = personnelData[index]?.telephone || "";
}

// ======== INIT ========
chargerMateriel();
chargerPersonnel();

// ======== PDF ========
document.getElementById('demandeForm').addEventListener('submit', function(e){
  e.preventDefault();
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

 // Bandeau en haut
doc.setFillColor(250,180,10);
doc.roundedRect(10,10,190,25,5,5,'F'); // rectangle orange
doc.setFontSize(16);
doc.setFont('helvetica','bold');
doc.setTextColor(0,0,0);

// Centrer le texte horizontalement dans le rectangle
const bandeauX = 10;
const bandeauWidth = 190;
const centerX = bandeauX + bandeauWidth / 2;

doc.text("Boussiquet Locations", centerX, 27, { align: 'center' });
doc.setFontSize(10);
doc.setFont('helvetica','normal');
doc.text("Demande interne de matériel", centerX, 34, { align: 'center' });

let y = 45;

  // Logos locaux
  const logoTop = new Image();
  logoTop.src = 'logo.png';
  logoTop.onload = function(){
    doc.addImage(logoTop,'PNG',10,10,20,20); // logo en haut à gauche
  };

  const logoBottom = new Image();
  logoBottom.src = 'logo2.png';
  logoBottom.onload = function(){
    doc.addImage(logoBottom,'PNG',160,250,30,30); // logo en bas à droite
  };

  // Récupération des données du formulaire
  const data = {
    "Matériel": {
      "Catégorie": document.getElementById('categorie').value,
      "Sous-type": document.getElementById('sousType').value || document.getElementById('sousTypeLibre').value,
      "Carburant": document.querySelector('input[name="carburant"]:checked')?.value || '',
      "Roues": document.querySelector('input[name="roues"]:checked')?.value || ''
    },
    "Chantier": {
      "Nom": document.getElementById('chantierNom').value,
      "Adresse": document.getElementById('chantierAdresse').value
    },
    "Location": {
      "Date début": document.getElementById('dateDebut').value,
      "Durée (jours)": document.getElementById('duree').value
    },
    "Chef d'équipe": {
      "Nom": document.getElementById('chefEquipe').selectedOptions[0].text,
      "Téléphone": document.getElementById('telephoneChef').value
    }
  };

  // Ajout des sections avec fond arrondi
  for(const section in data){
    const items = Object.keys(data[section]);
    const lineHeight = 8;
    const sectionHeight = items.length * lineHeight + 10;

    // Cadre
    doc.setFillColor(200,200,200);
    doc.roundedRect(15, y-5, 180, sectionHeight, 3, 3, 'F');

    // Titre section
    doc.setFontSize(12);
    doc.setTextColor(250,180,10); // jaune/orange pour titre
    doc.setFont('helvetica','bold');
    doc.text(section, 20, y);

    // Contenu
    let yInner = y + 6;
    doc.setFontSize(10);
    doc.setTextColor(50,50,50); // gris foncé pour lisibilité
    doc.setFont('helvetica','normal');
    for(const key in data[section]){
      doc.text(`${key}: ${data[section][key]}`, 25, yInner);
      yInner += lineHeight;
    }

    // Position pour la prochaine section
    y = y + sectionHeight + 10; // +10 = espace entre sections
  }

  // Sauvegarde du PDF
  doc.save(`Demande_${data["Matériel"]["Catégorie"]}_${data["Matériel"]["Sous-type"]}.pdf`);
});

</script>

</body>
</html>
